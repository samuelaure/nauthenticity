generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}


model Post {
  id              String   @id @default(uuid())
  instagramId     String?  @unique
  instagramUrl    String   @unique
  username        String?
  account         Account? @relation(fields: [username], references: [username])
  caption         String?
  postedAt        DateTime
  likes           Int      @default(0)
  comments        Int      @default(0)
  views           Int?
  engagementScore Float?
  
  runId           String?
  run             ScrapingRun? @relation(fields: [runId], references: [id])

  media           Media[]
  transcripts     Transcript[]
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([username])
}

model Account {
  username        String   @id
  profileImageUrl String?
  lastScrapedAt   DateTime @default(now())
  
  posts           Post[]
}

model ScrapingRun {
  id          String   @id @default(uuid())
  username    String
  actorRunId  String?  @unique
  datasetId   String?
  rawData     Json?    // Optional: store full JSON result for 24h fallback
  status      String   @default("completed") // "pending", "completed", "failed"
  
  posts       Post[]
  
  createdAt   DateTime @default(now())
}

model Media {
  id          String   @id @default(uuid())
  postId      String
  post        Post     @relation(fields: [postId], references: [id])
  type        String   // "video" | "image"
  storageUrl  String   // Local path or R2 URL
  duration    Float?
  
  createdAt   DateTime @default(now())
}

model Transcript {
  id          String   @id @default(uuid())
  postId      String
  post        Post     @relation(fields: [postId], references: [id])
  text        String
  json        Json?    // Full Whisper response with timestamps
  
  createdAt   DateTime @default(now())
}
